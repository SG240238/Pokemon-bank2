<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pago de Servicios - Banco Pokémon</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/servicios.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <header>
    <div class="text-center mb-4">
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png"
           alt="Pikachu"
           style="width: 120px; height: 120px; filter: drop-shadow(0 0 20px rgba(255,255,255,0.5));">
      <h1 class="text-white-shadow">Pokémon Bank</h1>
    </div>
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid justify-content-center">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu"
                aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-center" id="navbarMenu">
          <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="menu.html">Menu</a></li>
               <li class="nav-item"><a class="nav-link" href="menu.html">Menu</a></li>
               <li class="nav-item"><a class="nav-link" href="deposito.html">Depósito</a></li>
               <li class="nav-item"><a class="nav-link" href="retiro.html">Retirar</a></li>
               <li class="nav-item"><a class="nav-link" href="consulta.html">Consulta de Saldo</a></li>
               <li class="nav-item"><a class="nav-link" href="servicios.html">Pago de Servicios</a></li>
               <li class="nav-item"><a class="nav-link" href="historial.html">Historial</a></li>
               <li class="nav-item"><a class="nav-link" href="grafico.html">Analisis Grafico</a></li>
               <li class="nav-item"><a class="nav-link" href="index.html">Cerrar Sesion</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>
  <main class="container">
    <h3>Pago de Servicios</h3>
    <div class="mb-3">
      <strong>Saldo disponible: <span id="saldo"></span></strong>
    </div>
    <form id="serviciosForm" class="servicios-form">
      <div class="mb-3">
        <label for="servicio" class="form-label">Selecciona el servicio:</label>
        <select id="servicio" name="servicio" class="form-select" required>
          <option value="">-- Selecciona --</option>
          <option value="luz">Luz</option>
          <option value="agua">Agua</option>
          <option value="telefono">Teléfono</option>
          <option value="internet">Internet</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="referencia" class="form-label">Número de referencia:</label>
        <input type="text" id="referencia" name="referencia" class="form-control"
               required placeholder="Ej. 1234567890">
      </div>

      <div class="mb-3">
        <label for="monto" class="form-label">Monto a pagar:</label>
        <input type="number" id="monto" name="monto" class="form-control"
               required min="1" placeholder="$0.00">
      </div>

      <button id="btnPagar" type="submit" class="btn btn-primary">Pagar</button>
    </form>
  </main>

  <script src="js/bank.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      transacciones.render(); // Mostrar saldo disponible
      const form = document.getElementById("serviciosForm");
      form.addEventListener("submit", function(e) {
        e.preventDefault();
        const servicio = document.getElementById("servicio").value;
        const referenciaServicio = document.getElementById("referencia").value;
        const monto = Number(document.getElementById("monto").value);

        if (!servicio || !referenciaServicio || !monto || monto <= 0) {
          Swal.fire("Datos inválidos", "Completa todos los campos correctamente", "error");
          return;
        }

        let user = cargar();
        if (monto > user.saldo) {
          Swal.fire("Fondos insuficientes", "Tu saldo es " + money(user.saldo), "error");
          return;
        }

        Swal.fire({
          title: "¿Confirmar pago de servicio?",
          text: `Servicio: ${servicio}\nMonto: ${money(monto)}`,
          icon: "question",
          showCancelButton: true,
          confirmButtonText: "Sí, pagar"
        }).then(res => {
          if (!res.isConfirmed) return;

          user.saldo -= monto;
          user.transacciones.push({
            referencia: transacciones.generarNumeroReferencia(),
            tipo: "Pago de Servicio",
            descripcion: `Pago de ${servicio}`,
            monto: monto,
            fecha: new Date().toLocaleString(),
            servicio: servicio,
            referenciaServicio: referenciaServicio
          });
          guardar(user);
          transacciones.render();
          Swal.fire("Pago exitoso", "Nuevo saldo: " + money(user.saldo), "success");
          form.reset();
        });
      });
    });
  </script>

  <footer class="text-center mt-5">
    Pokémon Bank S.A. de C.V. © 2025<br>
    Atención al cliente: 800-123-4567 | contacto@pokemonbank.com<br>
    Todos los derechos reservados.
  </footer>
</body>
</html>
